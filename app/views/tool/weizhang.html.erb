<%= stylesheet_link_tag 'foundation.min' %>

<style>
  body{
    background: #F3F3F3;
  }
</style>
<div class="main_body">
  <div id="table_body" style="display: none"></div>
  <form id="form_body">

      <label>车牌号
        <input type="text" placeholder="请输入车牌号：苏AXXXXX" name="licence" id="licence">
      </label>

      <label>发动机号后六位
        <input type="text" placeholder="请输入发动机号后六位" name="engine_code" id="engine_code">
      </label>

      <a class="button expand" id="cha" style="margin-top: 30px;">查询</a>

  </form>
</div>

<script>
  var licence;
  var engine_code;

  $('#cha').click(function(){
    licence = $('#licence').val();
    engine_code = $('#engine_code').val();

    if(licence == "" || engine_code == ""){
      alert("请输入正确的车牌号及发动机后6位");
    }else{
      $.ajax({
        type: 'POST',
        url: '/tool/weizhang_result',
        data: {licence:licence, engine_code:engine_code},
        success: function(data){
          ShowProgressBar();
          if(data.job_status == 2){
            setTimeout(get_job(), 2000);
          }else{
            HideProgressBar();
            $('#form_body').slideUp();
            $('#table_body').html(data.content).slideDown();
          }
        },
        error:function(){
          alert('网络异常，请稍后再试！');
          HideProgressBar();
        },
        dataType: 'json'
      });
    }

  });


  function get_job(){
    $.ajax({
      type: 'POST',
      url: '/tool/weizhang_result',
      data: {licence:licence, engine_code:engine_code},
      success: function(data){
        if(data.job_status == 2){
          setTimeout(get_job(), 2000);
        }else{
          HideProgressBar();
          $('#form_body').slideUp();
          $('#table_body').html(data.content).slideDown();
        }
      },
      error:function(){
        alert('网络异常，请稍后再试！');
        HideProgressBar();
      },
      dataType: 'json'
    });
  }
</script>